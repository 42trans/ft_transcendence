<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>edit user profile</title>
</head>
<body>
<h1>edit user profile</h1>
<p id="message-area"></p>

<!-- ニックネーム更新用のフォーム -->
<form id="nickname-form" onsubmit="updateNickname(event)">
    <h2>nickname</h2>
    <p><input type="text" id="nickname" placeholder="{{ current_nickname }}" required></p>
    <button type="submit">update nickname</button>
</form>

<br>

<!-- パスワード更新用のフォーム -->
<form id="password-form" onsubmit="updatePassword(event)">
    <h2>password</h2>
    <p>current password: <input type="password" id="current_password" placeholder="current-password" required></p>
    <p>new password: <input type="password" id="new_password" placeholder="new-password"></p>
    <button type="submit">update password</button>
</form>

<script>
    function updateNickname(event) {
        event.preventDefault();
        const nickname = document.getElementById('nickname').value;

        fetch('/accounts/api/user/edit-profile/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
            },
            body: JSON.stringify({
                nickname: nickname,
            })
        })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('message-area').textContent = data.error;
                } else {
                    document.getElementById('message-area').textContent = data.message;
                    console.log('Success:', data.message);
                }
            })
            .catch(error => console.error('Error:', error));
    }

    function updatePassword(event) {
        event.preventDefault();
        const currentPassword = document.getElementById('current_password').value;
        const newPassword = document.getElementById('new_password').value;

        fetch('/accounts/api/user/edit-profile/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
            },
            body: JSON.stringify({
                current_password: currentPassword,
                new_password: newPassword
            })
        })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('message-area').textContent = data.error;
                } else {
                    document.getElementById('message-area').textContent = data.message;
                    console.log('Success:', data.message);
                }
            })
            .catch(error => console.error('Error:', error));
    }
</script>

<hr>
<a href="{% url 'accounts:user'%}">return to user page</a>
<hr>
<a href="/pong">🏓 return to pong</a>
</body>
</html>



<!--{% load static %}-->
<!--<!doctype html>-->
<!--<html lang="ja">-->
<!--<head>-->
<!--    <meta charset="utf-8">-->
<!--    <title>edit profile</title>-->

<!--    <style>-->
<!--        .success-message {-->
<!--            color: blue;-->
<!--        }-->
<!--        .errorlist {-->
<!--            color: red;-->
<!--        }-->
<!--    </style>-->

<!--</head>-->
<!--<body>-->

<!--{% block content %}-->
<!--<div class="container">-->
<!--    <h2>Edit Profile</h2>-->

<!--    <hr>-->

<!--    &lt;!&ndash; フィードバックメッセージの表示 &ndash;&gt;-->
<!--    {% if messages %}-->
<!--    <ul class="messages">-->
<!--        {% for message in messages %}-->
<!--        <li {% if message.tags %} class="{{ message.tags }} success-message"{% endif %}>{{ message }}</li>-->
<!--        {% endfor %}-->
<!--    </ul>-->
<!--    {% endif %}-->

<!--    &lt;!&ndash; ニックネーム編集フォーム &ndash;&gt;-->
<!--    <form method="post">-->
<!--        {% csrf_token %}-->
<!--        <h4>Edit Nickname</h4>-->
<!--        {{ user_form.as_p }}-->
<!--        <button type="submit">change nickname</button>-->
<!--    </form>-->

<!--    <br>-->

<!--    {% if password_form %}-->
<!--    <hr>-->
<!--    &lt;!&ndash; パスワード変更フォーム &ndash;&gt;-->
<!--    <form method="post">-->
<!--        {% csrf_token %}-->
<!--        <h4>Change Password</h4>-->
<!--        {% for field in password_form %}-->
<!--        <p>-->
<!--            {{ field.help_text }}-->
<!--            {{ field.errors }}-->
<!--            {{ field.label_tag }} {{ field }}-->
<!--        </p>-->
<!--        {% endfor %}-->
<!--        <button type="submit">change password</button>-->
<!--    </form>-->
<!--    {% endif %}-->

<!--</div>-->
<!--{% endblock %}-->

<!--<hr>-->
<!--<br>-->
<!--<a href="/pong/">🏓 pong index page</a>-->

<!--</body>-->

<!--</html>-->
