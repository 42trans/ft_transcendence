{% comment %} <!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>Enable 2FA</title>
</head>
<body>
<h2>Enable Two-Factor Authentication (2FA)</h2>

<div id="qrCodeContainer" style="margin-bottom: 20px;"></div>
<div id="error-message" style="color: red;"></div>

<form id="enableForm">
  <label for="token">Verification Code:</label>
  <input type="text" id="token" name="token" required>
  <button type="button" onclick="verifyToken()">Enable 2FA</button>
</form>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    fetch('/accounts/api/enable_2fa/', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      }
    })
            .then(response => response.json())
            .then(data => {
              if (data.error) {
                document.getElementById('error-message').textContent = "Error retrieving 2FA setup: " + data.error;
              } else if (data.redirect) {
                console.log(data.message);
                window.location.href = data.redirect;
              }
              else {
                const qrCodeHtml = `
                <p>Scan this QR Code with your authenticator app:</p>
                <img src="data:image/png;base64,${data.qr_code_data}" alt="2FA QR Code"><br>
                <p>Or enter this setup key: ${data.setup_key}</p>
            `;
                document.getElementById('qrCodeContainer').innerHTML = qrCodeHtml;
              }
            })
            .catch(error => {
              document.getElementById('error-message').textContent = "Network error or server is down.";
              console.error("Fetch error:", error);
            });
  });

  function verifyToken() {
    const token = document.getElementById('token').value;
    fetch('/accounts/api/enable_2fa/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ token: token })
    })
            .then(response => response.json())
            .then(data => {
              if (data.error) {
                document.getElementById('error-message').textContent = "Verification failed: " + data.error;
              } else if (data.redirect) {
                console.log(data.message);
                window.location.href = data.redirect;
              } else if (data.success) {
                console.log(data.message);
                alert(data.message);
                window.location.href = data.redirect;
              }
            })
            .catch(error => {
              document.getElementById('error-message').textContent = "Network error or server is down.";
              console.error("Fetch error:", error);
            });
  }
</script>

<hr>
<a href="/accounts/user/">Return to user page</a>
<br>
<a href="/pong/">ğŸ“ Return to pong</a>
</body>
</html>

<!--{% load static %}-->
<!--<!doctype html>-->
<!--<html lang="ja">-->
<!--<head>-->
<!--  <meta charset="utf-8">-->
<!--  <title>2FA</title>-->
<!--</head>-->
<!--<body>-->
<!--<h2>Enable Two-Factor Authentication (2FA)</h2>-->

<!--{% if qr_code_data %}-->
<!--  <p>ä»¥ä¸‹ã®QRã‚³ãƒ¼ãƒ‰ or Setup Keyã‚’Authenticatorã«ç™»éŒ²ã—ã¦ãã ã•ã„</p>-->
<!--  <img src="data:image/png;base64,{{ qr_code_data }}" alt="2FA QR Code">-->
<!--  <br>-->

<!--  <p>setup key: {{ setup_key }}</p>-->
<!--  <p>Setup Keyã¯QRã‚³ãƒ¼ãƒ‰ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã«ã‚‚ãªã‚Šã¾ã™ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«æ³¨æ„ã—ã¦å¤§åˆ‡ã«ä¿ç®¡ã—ã¦ãã ã•ã„ã€‚</p>-->
<!--  <br>-->
<!--  <p>ã‚¢ãƒ—ãƒªãŒç”Ÿæˆã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã§èªè¨¼ã—ã¦ãã ã•ã„</p>-->
<!--{% endif %}-->

<!--<form method="post">-->
<!--  {% csrf_token %}-->
<!--  <label for="token">Verification Code:</label>-->
<!--  <input type="text" id="token" name="token" required>-->

<!--  &lt;!&ndash; ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º &ndash;&gt;-->
<!--  {% if form.non_field_errors %}-->
<!--  <div class="error" style="color: red;">-->
<!--    {% for error in form.non_field_errors %}-->
<!--    {{ error }}-->
<!--    {% endfor %}-->
<!--  </div>-->
<!--  {% endif %}-->

<!--  <button type="submit" class="btn btn-primary">Verify and Enable 2FA</button>-->
<!--</form>-->

<!--<hr>-->
<!--<a href="{% url 'accounts:user'%}">return to user page</a>-->
<!--<hr>-->
<!--<a href="/pong">ğŸ“ return to pong</a>-->
<!--</body>-->
<!--</html>--> {% endcomment %}
