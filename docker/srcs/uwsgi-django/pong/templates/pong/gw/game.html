{% extends 'pong/gw/base.html' %}
{% load static %}
{% block title %}Game - hth Pong{% endblock title %}

{% block content %}

	<script type="importmap">
	{
		"imports": {
		"three": "https://unpkg.com/three@0.152.2/build/three.module.js",
		"three/addons/": "https://unpkg.com/three@0.152.2/examples/jsm/"
		}
	}
	</script>

	<script type="module">
	import * as THREE from "three";
	import { OrbitControls } from "three/addons/controls/OrbitControls.js";
	import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";

	// サイズを指定
	const width = 920;
	const height = 690;

	// // レンダラーを作成
	const canvasElement = document.querySelector("#myCanvas");
	const renderer = new THREE.WebGLRenderer({
		canvas: canvasElement,
	});
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.setSize(width, height);

	// シーンを作成
	const scene = new THREE.Scene();

	// カメラを作成
	const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 10000);
	// カメラの初期座標を設定
	camera.position.set(1, 1, 1);

	// カメラコントローラーを作成
	const controls = new OrbitControls(camera, canvasElement);
	controls.target.set(0, 0, 0);
	controls.update();

	// 平行光源を作成
	// 上から照らす
	const directionalLight = new THREE.DirectionalLight(0xffffff);
	directionalLight.position.set(1, 1, 1);
	scene.add(directionalLight);

	// 横からテラス
	const directionalLight2 = new THREE.DirectionalLight(0xffffff);
	directionalLight2.position.set(1, 0, 1);
	scene.add(directionalLight2);

	// GLTF形式のモデルデータを読み込む
	const loader = new GLTFLoader();
	// GLTFファイルのパスを指定
	const modelPath = document.getElementById('modelPath').dataset.modelPath;
	const gltf = await loader.loadAsync(modelPath); // 変更部分
	// const gltf = await loader.loadAsync("{% static 'gw/img/scene.gltf");
	// 読み込み後に3D空間に追加
	const model = gltf.scene;
	scene.add(model);

	model.scale.set(0.5, 0.5, 0.5);

	tick();

	// 毎フレーム時に実行されるループイベントです
	function tick() {
		// レンダリング
		renderer.render(scene, camera);
		requestAnimationFrame(tick);
	}
	</script>

<style>
	/* Canvasのスタイリング */
	.canvas-container {
	width: 100%; /* コンテナの幅 */
	height: 900px;
	display: flex; /* Flexboxを使用 */
	justify-content: center; /* 水平方向中央揃え */
	align-items: center; /* 垂直方向中央揃え */
	background: url('{% static "gw/img/background.png" %}') no-repeat center center; /* 背景画像の設定 */
	background-size: cover; /* 背景画像をカバーとして設定 */
	position: relative;
	}
	.text-overlay {
		position: absolute;
		bottom: 20px; /* 下部からの距離を調整 */
		left: 50%; /* 横方向中央揃え */
		transform: translateX(-50%); /* 横方向中央揃え */
	}
</style>
<div id="modelPath" data-model-path="{% static 'gw/img/three/scene.gltf' %}"></div>

			
		<div class="canvas-container">
				<canvas id="myCanvas"></canvas>
			
				<div class="text-overlay">
					<a href="#" class="site-btn">Start</a>
				</div>
				
			</div>

</section>

{% endblock %}